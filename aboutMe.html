<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>我的毕设记录</title>
		<meta name="referrer" content="no-referrer" />
		<link rel="stylesheet" href="css/aboutMe.css" />
		<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<!-- 开发环境版本，包含了有帮助的命令行警告 -->
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<!--  axios 在线地址 -->
		<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.0/axios.min.js"></script>
	</head>
	<body>
		<div id="bigBox">
			<!-- 头部导航栏 -->
			<div class="nva">
				<!-- <div class="left"><a href="index.html">返回首页</a> </div> -->
				<img src="img/back.png" onclick="javascript:location.href='index.html'" title="返回首页"/>
				<div class="right" v-show="islogin!='登录'"><a href="JavaScript:void(0)" @click="logOut">注销</a></div>
				<div class="right"><a href="JavaScript:void(0)" v-text="islogin" @click="isJump">登录</a></div>
			</div>
			<!--end 头部导航栏 -->
			<div id="about-box">
				<div id="head-title">
					<h2>我的毕设日志</h2>
				</div>
				<!-- 日志内容展示区域 -->
				<div id="log-box">
					<div id="log-list" v-for="logContent in logArray">
						<span v-text="logContent[0]">2020-10-19</span><br />
						<strong v-html="logContent[1]">666</strong><br />
					</div>
				</div>
				<!-- end 日志内容展示区域-->
				<!-- 发表框 -->
				<div id="edit-log" v-if="visible==true">
					<input value="" v-model="dataTime" placeholder="输入时间" /><br /><br />
					<textarea v-model="content"></textarea>
					<button @click="sedLog"> 发表日志 </button>
				</div>
				<!--end 发表框 -->
			</div>
		</div>
	</body>
	<script type="text/javascript">
		new Vue({
			el: '#bigBox',
			data: {
				//发表时间
				dataTime: '',
				//发表内容
				content: '',
				//接收后台返回的数据
				logArray: [],
				//控制编辑宽显示还是隐藏
				visible: false,
				//用户名
				islogin:'登录'
			},
			methods: {
				//发表评论
				sedLog: function() {
					if (this.dataTime != '' && this.content != '') {
						axios.get('php/aboutMe.php', {
							params: {
								dataTime: this.dataTime,
								content: this.content
							}
						}, ).then(response => {
							console.log(response.data);
							if (response.data == '成功') {
								this.dataTime = '';
								this.content = '';
								this.show();
							}
						})
					} else {
						alert('内容或时间没写！');
					}

				},
				//提取评论
				show() {
					axios.get('php/aboutMe.php', {
						params: {
							dataTime: '0',
							content: '0'
						}
					}, ).then(response => {
						this.logArray = response.data;
					})
				},
				//验证用户名是否为【陈绪运】否则不显示日志发送框
				userVrification: function() {
					axios.get('php/userVrification.php').then(response => {
						if (response.data == '陈绪运') {
							this.visible = true;
						}
						if(response.data!=false){
							this.islogin = response.data;
						}
					})
				},
				//退出登录
				logOut(){
					axios.get('php/logOut.php').then(response => {
						this.userVrification();
						this.show();
						this.islogin = '登录'
					})
				},
				isJump(){
					if(this.islogin == '登录'){
						window.location.href = 'login.html';
					}
				}

			},
			mounted() {
				this.show();
				this.userVrification();
			}
		})
	</script>
</html>
